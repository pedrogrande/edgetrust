---
/**
 * Task List Page
 *
 * Browse and filter available tasks
 * Public access - no authentication required
 */

import Layout from '@/layouts/Layout.astro';
import { TaskList } from '@/components/trust-builder/TaskList';
import { TaskFilter } from '@/components/trust-builder/TaskFilter';
import { Button } from '@/components/ui/button';

// Get mission filter from query params
const missionId = Astro.url.searchParams.get('mission');

// Fetch tasks
const tasksUrl = new URL('/api/trust-builder/tasks', Astro.url.origin);
if (missionId) {
  tasksUrl.searchParams.set('mission', missionId);
}
const tasksResponse = await fetch(tasksUrl.toString());
const { tasks } = await tasksResponse.json();

// Fetch missions for filter dropdown
const missionsResponse = await fetch(
  `${Astro.url.origin}/api/trust-builder/missions`
);
const { missions } = await missionsResponse.json();
---

<Layout title="Available Tasks - Trust Builder">
  <div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-start justify-between mb-4 flex-wrap gap-4">
        <div>
          <h1 class="text-4xl font-bold mb-2">Available Tasks</h1>
          <p class="text-muted-foreground">
            {tasks.length}
            {tasks.length === 1 ? 'task' : 'tasks'} available
          </p>
        </div>
        <a href="/trust-builder">
          <Button variant="outline"> ‚Üê Back to Hub </Button>
        </a>
      </div>

      <!-- Filter -->
      {
        missions.length > 1 && (
          <div class="mb-6">
            <TaskFilter
              missions={missions}
              selectedMissionId={missionId}
              client:load
            />
          </div>
        )
      }
    </div>

    <!-- Task Grid -->
    <TaskList tasks={tasks} />
  </div>
</Layout>
